<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Final Project</title>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }
        </style>
        <!-- Babylon.js -->
        <script src="https://code.jquery.com/pep/0.4.2/pep.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/ammo.js"></script>
        <script src="https://preview.babylonjs.com/cannon.js"></script>
        <script src="https://preview.babylonjs.com/Oimo.js"></script>
        <script src="https://preview.babylonjs.com/libktx.js"></script>
        <script src="https://preview.babylonjs.com/earcut.min.js"></script>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>
        <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
    </head>

   <body>

    <canvas id="renderCanvas" touch-action="none"></canvas> //touch-action="none" for best results from PEP

    <script>
        var canvas = document.getElementById("renderCanvas"); // Get the canvas element
        var engine = new BABYLON.Engine(canvas, true); // Generate the BABYLON 3D engine

        /******* Add the create scene function ******/
        var createScene = function () {
          // Create Scene
        	var scene = new BABYLON.Scene(engine);
          scene.clearColor = new BABYLON.Color3(0, 0, 0);

          /******* Flags ******/
          var emissiveFlag = true;

          /******* Materials ******/

          // Colors
          var colors = [
        		new BABYLON.Color3(1, 0.1, 0),
        		new BABYLON.Color3(0.2, 0.9, 0),
        		new BABYLON.Color3(1, 1, 0),
        		new BABYLON.Color3(0.1, 0.2, 1),
            new BABYLON.Color4(0, 0, 0, 0),
            new BABYLON.Color3(1, 1, 1)
        	]

          // Box Materials
          var redMaterial = new BABYLON.StandardMaterial("redMaterial", scene);
          redMaterial.diffuseColor = colors[0];
          var greenMaterial = new BABYLON.StandardMaterial("greenMaterial", scene);
          greenMaterial.diffuseColor = colors[1];
          var yellowMaterial = new BABYLON.StandardMaterial("yellowMaterial", scene);
          yellowMaterial.diffuseColor = colors[2];
          var blueMaterial = new BABYLON.StandardMaterial("blueMaterial", scene);
          blueMaterial.diffuseColor = colors[3];

          // Ground Material
          var groundMaterial = new BABYLON.StandardMaterial("myMaterial", scene);
          groundMaterial.ambientTexture = new BABYLON.Texture("file:///Users/austingarner/Dropbox/School/2nd%20Quarter/Computer%20Graphics/Final%20Project/media/marioKartTrack.png", scene);

          // SkyBox material
          var skyBoxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
          skyBoxMaterial.backFaceCulling = false;
          skyBoxMaterial.reflectionTexture = new BABYLON.CubeTexture("file:///Users/austingarner/Dropbox/School/2nd%20Quarter/Computer%20Graphics/Final%20Project/media/skyBox/sky", scene);
          skyBoxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
          skyBoxMaterial.disableLighting = true;
          var skyBox = BABYLON.Mesh.CreateBox("skyBox", 2000, scene);
          skyBox.material = skyBoxMaterial;
          // skyBox.infiniteDistance = true;
          skyBox.renderingGroupId = 0;

          // Banner Material
          var bannerMaterial = new BABYLON.StandardMaterial("bannerMaterial", scene);
          bannerMaterial.ambientTexture = new BABYLON.Texture("file:///Users/austingarner/Dropbox/School/2nd%20Quarter/Computer%20Graphics/Final%20Project/media/logo.png", scene);

          /******* Creating Cameras ******/
          // createCameraForward(-300,-300);
          // createCameraDown(-130,-400);
          // createArcCamera(0,0);
          createButtonsCamera();

          // Camera Looking Forward
          function createCameraForward(x,z) {
            var camera = new BABYLON.UniversalCamera("UniversalCamera", new BABYLON.Vector3(x,100,z), scene);
            camera.attachControl(canvas, true);
            camera.speed = 25;
          }
          // Camera Looking Down
          function createCameraDown(x,z) {
            var camera = new BABYLON.UniversalCamera("UniversalCamera", new BABYLON.Vector3(x,200,z), scene);
            camera.attachControl(canvas, true);
            camera.speed = 25;
            camera.setTarget(new BABYLON.Vector3(x,-20,z));
          }
          // Arc Rotate Camera
          function createArcCamera(x,z) {
            var camera = new BABYLON.ArcRotateCamera("Camera", 0, (Math.PI / 4), 500, new BABYLON.Vector3(x,1,z), scene);
            camera.attachControl(canvas, true);
          }
          // Buttons Camera
          function createButtonsCamera() {
            var camera = new BABYLON.UniversalCamera("UniversalCamera", new BABYLON.Vector3(-703,300,-703), scene);
            camera.setTarget(new BABYLON.Vector3(-700,300,-700));
          }

          /******* Add Lights ******/
          // Lights
          var hemiLight = new BABYLON.HemisphericLight("hemi", new BABYLON.Vector3(0, 1, 0), scene);
          var pointLight = new BABYLON.PointLight("pointLight", new BABYLON.Vector3(600, 90, 600), scene);
          // Sun
          var sunMaterial = new BABYLON.StandardMaterial("sunMaterial", scene);
          sunMaterial.emissiveColor = new BABYLON.Color3(1, 1, 0);
          var sun = BABYLON.MeshBuilder.CreateSphere("sun", {diameter: 100}, scene);
          sun.position = new BABYLON.Vector3(600,90,600);
          sun.material = sunMaterial;

          /******* Creating Ground ******/
          createGround();
          function createGround() {
            var myGround = BABYLON.MeshBuilder.CreateGround("myGround", {width: 1024, height: 1024}, scene);
            //groundMaterial.ambientTexture = new BABYLON.Texture("http://www.hpgreenvivarium.com/wp-content/uploads/2020/02/marioKartTrack.png", scene);
            //groundMaterial.ambientTexture = new BABYLON.Texture("http://www.mariouniverse.com/wp-content/img/maps/snes/smk/mariocircuit-3.png", scene);
            //groundMaterial.ambientTexture = new BABYLON.Texture("file:///C:/Users/atg20/Dropbox/School/2nd%20Quarter/Computer%20Graphics/Final%20Project/media/marioKartTrack.png", scene);
            myGround.material = groundMaterial;
          }

          /******* Creating Wall Blocks ******/
          createWalls();
          function createBoxLine(startBox,startPosition,endPosition,constPosition,constAxis) {

            // Setting variables
            var x = 0, y = 4, z = 0;
            var offset = 32;
            var increment = 128;
            var direction = true;
            var names = ["redBox","greenBox","yellowBox","blueBox"];
            var colorNames = ["redMaterial", "greenMaterial","yellowMaterial","blueMaterial"];
            var boxColor = names.indexOf(startBox);

            // Setting direction
            if (startPosition > endPosition) {
              increment = -128;
              direction = false;
            } else {
              increment = 128;
              direction = true;
            }

            // Setting the constant axis
            if(constAxis == "x") {
              x = constPosition;
            } else if(constAxis == "z") {
              z = constPosition;
            }

            // temp fix
            if(direction) {
              // loop for box color
              for (let a = 0; a < 4; a++) {
                var boxColorName = names[boxColor];
                var boxColorTexture = colorNames[boxColor];
                var flag1 = true,flag2 = true;
                // loop for all boxes of color in range
                for (let i = startPosition + offset * a; i < endPosition; i += increment) {
                  // loop for each individual box
                  for (let j = i; (j < (i + 32)) && (j <= endPosition); j += 8) {
                    var boxNameJ = j.toString();
                    if(constAxis == 'x') {
                      z = j;
                      var boxNameTempX = x.toString();
                      var boxNameX = boxNameTempX.replace("-","Negative");
                      var boxNameZ = boxNameJ.replace("-","Negative");
                    } else if(constAxis == 'z') {
                      x = j;
                      var boxNameTempZ = z.toString();
                      var boxNameX = boxNameJ.replace("-","Negative");
                      var boxNameZ = boxNameTempZ.replace("-","Negative");
                    }
                    var boxName = boxColorName.concat(boxNameX,"_",boxNameZ);
                    eval('var ' + boxName + ' = ' + 'BABYLON.MeshBuilder.CreateBox("' + boxColorName + '", {size: 8.0}, scene);');
                    eval(boxName + '.position = new BABYLON.Vector3(' + x + ',' + y + ',' + z + ');');
                    eval(boxName + '.material = ' + boxColorTexture);
                    // console.log(boxName);
                  }
                }
                // setting boxColor increment
                if (boxColor == 3) {
                  boxColor = 0;
                } else {
                  boxColor++;
                }
              }
            } else {
              // loop for box color
              for (let a = 0; a < 4; a++) {
                var boxColorName = names[boxColor];
                var boxColorTexture = colorNames[boxColor];
                // loop for all boxes of color in range
                for (let i = startPosition - offset * a; i > endPosition; i += increment) {
                  // loop for each individual box
                  for (let j = i; (j > (i - 32)) && (j >= endPosition); j -= 8) {
                    var boxNameJ = j.toString();
                    if(constAxis == 'x') {
                      z = j;
                      var boxNameTempX = x.toString();
                      var boxNameX = boxNameTempX.replace("-","Negative");
                      var boxNameZ = boxNameJ.replace("-","Negative");
                    } else if(constAxis == 'z') {
                      x = j;
                      var boxNameTempZ = z.toString();
                      var boxNameX = boxNameJ.replace("-","Negative");
                      var boxNameZ = boxNameTempZ.replace("-","Negative");
                    }
                    var boxName = boxColorName.concat(boxNameX,"_",boxNameZ);
                    eval('var ' + boxName + ' = ' + 'BABYLON.MeshBuilder.CreateBox("' + boxColorName + '", {size: 8.0}, scene);');
                    eval(boxName + '.position = new BABYLON.Vector3(' + x + ',' + y + ',' + z + ');');
                    eval(boxName + '.material = ' + boxColorTexture);
                    // console.log(boxName);
                  }
                }
                // setting boxColor increment
                if (boxColor == 3) {
                  boxColor = 0;
                } else {
                  boxColor++;
                }
              }
            }
          }
          function createWalls() {
            createOutsideWalls();
            createInsideWalls();
            createFatBox();
            createSkinnyBox();
            createJaggedWall();

            function createOutsideWalls() {
              // Positive Z Wall
              createBoxLine("redBox",-508,-52,508,'z');
              createBoxLine("blueBox",52,60,508,'z');
              createBoxLine("redBox",68,508,508,'z');
              // Positive X Wall
              createBoxLine("yellowBox",500,28,508,'x');
              createBoxLine("blueBox",-44,-508,508,'x');
              // Negative Z Wall
              createBoxLine("greenBox",500,484,-508,'z');
              createBoxLine("yellowBox",476,-508,-508,'z');
              // Negative X Wall
              createBoxLine("redBox",-500,-492,-508,'x');
              createBoxLine("greenBox",-484,500,-508,'x');
            }
            function createInsideWalls() {
              // Final Turn Straight
              createBoxLine("yellowBox",-340,-244,348,'z');
              // Turn 5 left
              createBoxLine("greenBox",348,132,-244,'x');
              // Turn 5 - 4 straight
              createBoxLine("redBox",-236,156,132,'z');
              // Turn 4 jagged
              createBoxLine("redBox",140,148,156,'x');
              createBoxLine("greenBox",156,180,156,'z');
              createBoxLine("yellowBox",156,180,188,'x');
              createBoxLine("blueBox",196,220,180,'z');
              // Turn 4 straight
              createBoxLine("redBox",180,324,228,'x');
              // Roundabout top
              createBoxLine("redBox",228,236,324,'z');
              createBoxLine("greenBox",244,332,324,'z');
              // Roundabout side
              createBoxLine("redBox",316,164,332,'x');
              // Roundabout bottom
              createBoxLine("greenBox",332,212,156,'z');
              // Tilted straight jagged right
              createBoxLine("greenBox",148,140,212,'x');
              createBoxLine("greenBox",212,204,132,'z');
              createBoxLine("yellowBox",196,188,132,'z');
              createBoxLine("yellowBox",132,124,180,'x');
              createBoxLine("blueBox",116,108,180,'x');
              // Tilted Straight straight
              createBoxLine("blueBox",172,164,108,'z');
              createBoxLine("redBox",156,-28,108,'z');
              createBoxLine("yellowBox",108,84,-36,'x');
              createBoxLine("blueBox",-44,-244,84,'z');
              // Hairpin Straight
              createBoxLine("greenBox",76,68,-244,'x');
              createBoxLine("yellowBox",60,-44,-244,'x');
              createBoxLine("greenBox",-244,-252,-52,'z');
              createBoxLine("yellowBox",-260,-268,-52,'z');
              createBoxLine("yellowBox",-60,-68,-268,'x');
              createBoxLine("blueBox",-76,-228,-268,'x');
              // Straight Straight
              createBoxLine("redBox",-260,324,-228,'z');
              // Turn 3 - 2
              createBoxLine("yellowBox",-228,-240,332,'x');
              createBoxLine("blueBox",-244,-300,332,'x');
              // Turn 2 straight
              createBoxLine("greenBox",332,212,-308,'z');
              createBoxLine("greenBox",204,196,-308,'z');
              // 1st spill right
              createBoxLine("greenBox",-300,-252,196,'x');
              // 1st spill straight
              createBoxLine("blueBox",188,-180,-252,'z');
              // 2nd spill left
              createBoxLine("yellowBox",-252,-260,-188,'x');
              createBoxLine("blueBox",-268,-324,-188,'x');
              createBoxLine("greenBox",-332,-340,-188,'x');
              // Turn 1 flat
              createBoxLine("greenBox",-196,-204,-340,'z');
              createBoxLine("yellowBox",-212,-332,-340,'z');
              // Turn 1 spike
              createBoxLine("redBox",-348,-404,-268,'x');
              createBoxLine("yellowBox",-404,-348,-276,'x');
              // Straightaway
              createBoxLine("yellowBox",-340,-220,-340,'x');
              // Straightaway jagged
              for(let i = 0; i < 560; i += 80) {
                createBoxLine("yellowBox",-340,-364,(-212+i),'z');
                createBoxLine("blueBox",(-204+i),(-180+i),-364,'x');
                createBoxLine("redBox",-340,-364,(-172+i),'z');
                createBoxLine("greenBox",(-164+i),(-140+i),-340,'x');
                console.log(i);
              }
            }
            function createFatBox() {
              // Left Wall
              createBoxLine("yellowBox",500,492,-52,'x');
              createBoxLine("blueBox",484,284,-52,'x');
              // Front Wall
              createBoxLine("greenBox",-44,-36,284,'z');
              createBoxLine("yellowBox",-28,44,284,'z');
              // Right Wall
              createBoxLine("redBox",284,292,52,'x');
              createBoxLine("greenBox",300,500,52,'x');
            }
            function createSkinnyBox() {
              // 1st Edge Boxes
              createBoxLine("greenBox",-500,-468,12,'x');
              createBoxLine("blueBox",-500,-468,4,'x');
              // 2nd Edge Boxes
              createBoxLine("yellowBox",-468,-436,12,'x');
              createBoxLine("redBox",-468,-436,4,'x');
              // 1st Seperate Boxes
              createBoxLine("redBox",-420,-404,12,'x');
              createBoxLine("greenBox",-420,-404,4,'x');
              // 2nd Seperate Boxes
              createBoxLine("blueBox",-396,-380,12,'x');
              createBoxLine("yellowBox",-396,-380,4,'x');
            }
            function createJaggedWall() {
              // Top Wall
              createBoxLine("greenBox",508,308,20,'z');
              createBoxLine("blueBox",12,4,308,'x');
              createBoxLine("redBox",-4,-12,308,'x');
              createBoxLine("redBox",300,292,-12,'z');
              createBoxLine("greenBox",284,132,-12,'z');
              createBoxLine("yellowBox",-20,-44,132,'x');
              createBoxLine("blueBox",132,-20,-52,'z');
              createBoxLine("yellowBox",-52,-60,-28,'x');
              createBoxLine("yellowBox",-36,-44,-60,'z');
              // Bottom Wall
              createBoxLine("redBox",-60,140,-68,'z');
              createBoxLine("yellowBox",-68,-60,148,'x');
              createBoxLine("blueBox",-52,-44,148,'x');
              createBoxLine("blueBox",148,156,-36,'z');
              createBoxLine("redBox",164,508,-36,'z');
            }
          }

          /******* Trees ******/
          createTrees();
          function createTrees() {
            //var spriteManagerTrees = new BABYLON.SpriteManager("treesManager", "file:///C:/Users/atg20/Dropbox/School/2nd%20Quarter/Computer%20Graphics/Final%20Project/media/tree.png", 2000, {width: 320, height: 555}, scene);
            var spriteManagerTrees = new BABYLON.SpriteManager("treesManager","file:///Users/austingarner/Dropbox/School/2nd%20Quarter/Computer%20Graphics/Final%20Project/media/tree.png", 2000, {width: 320, height: 555}, scene);
            // Trees in long rectangle
            for (var i = 0; i < 10; i++) {
              var tree = new BABYLON.Sprite("tree", spriteManagerTrees);
              tree.position.x = Math.random() * (-330 + 280) - 280;
              tree.position.y = 25;
              tree.position.z = Math.random() * (330 + 320) - 320;
              tree.isPickable = true;
              tree.size = 50;
              console.log(Math.random());
            }
            // Trees in fat side box
            for (var i = 0; i < 5; i++) {
              var tree = new BABYLON.Sprite("tree", spriteManagerTrees);
              tree.position.x = Math.random() * (40 + 40) - 40;
              tree.position.y = 25;
              tree.position.z = Math.random() * (500 - 300) + 300;
              tree.isPickable = true;
              tree.size = 50;
              console.log(Math.random());
            }
            // Trees in positive box
            for (var i = 0; i < 5; i++) {
              var tree = new BABYLON.Sprite("tree", spriteManagerTrees);
              tree.position.x = Math.random() * (320 - 240) + 240;
              tree.position.y = 25;
              tree.position.z = Math.random() * (310 - 170) + 170;
              tree.isPickable = true;
              tree.size = 50;
              console.log(Math.random());
            }
            // Trees in skinny side box
            for (var i = 0; i < 5; i++) {
              var tree = new BABYLON.Sprite("tree", spriteManagerTrees);
              tree.position.x = Math.random() * (500 - 300) + 300;
              tree.position.y = 25;
              tree.position.z = Math.random() * (20 + 30) - 30;
              tree.isPickable = true;
              tree.size = 50;
              console.log(Math.random());
            }
            // Trees in skinny middle box
            for (var i = 0; i < 5; i++) {
              var tree = new BABYLON.Sprite("tree", spriteManagerTrees);
              tree.position.x = Math.random() * (320 - 210) + 210;
              tree.position.y = 25;
              tree.position.z = Math.random() * (-240 + 290) - 290;
              tree.isPickable = true;
              tree.size = 50;
              console.log(Math.random());
            }
          }

          /******* Create Finish Line ******/
          createFinishLine();
          function createFinishLine() {
            createScaffolding();
            createFinishBanner();
            function createScaffolding() {
              // Create Left Pillar
              var finishBoxLeft = BABYLON.MeshBuilder.CreateBox("finishBoxLeft", {height: 80, width: 8, depth: 8}, scene);
              finishBoxLeft.position = new BABYLON.Vector3(-476,40,84);
              finishBoxLeft.material = redMaterial;
              // Create Right Pillar
              var finishBoxRight = BABYLON.MeshBuilder.CreateBox("finishBoxRight",{height: 80, width: 8, depth: 8}, scene);
              finishBoxRight.position = new BABYLON.Vector3(-388,40,84);
              finishBoxRight.material = greenMaterial;
              // Create Top Pillar
              var finishBannerTop = BABYLON.MeshBuilder.CreateBox("finishBannerTop", {height: 4, width: 80, depth: 4}, scene);
              finishBannerTop.position = new BABYLON.Vector3(-432,78,84);
              finishBannerTop.material = yellowMaterial;
              // Create Bottom Pillar
              var finishBannerBottom = BABYLON.MeshBuilder.CreateBox("finishBannerBottom", {height: 4, width: 80, depth: 4}, scene);
              finishBannerBottom.position = new BABYLON.Vector3(-432,58,84);
              finishBannerBottom.material = blueMaterial;
            }
            function createFinishBanner() {
              // Create planes with banner
              bannerMaterial.backFaceCulling = false;
              var banner1 = BABYLON.MeshBuilder.CreatePlane("banner1", {width: 80, height: 16}, scene);
              banner1.material = bannerMaterial;
              banner1.position = new BABYLON.Vector3(-432,68,82);
              var banner2 = BABYLON.MeshBuilder.CreatePlane("banner1", {width: 80, height: 16}, scene);
              banner2.material = bannerMaterial;
              banner2.rotation = new BABYLON.Vector3(0, Math.PI, 0);
              banner2.position = new BABYLON.Vector3(-432,68,86);

            }
          }

          /******* Create Cheering People ******/
          createCrowd();
          function createCrowd() {
            createPeople();
            createBleachers();
            function createPeople() {
              var mat = new BABYLON.StandardMaterial("mat1", scene);
              mat.alpha = 1.0;
              mat.diffuseColor = new BABYLON.Color3(1, 1, 1);
              mat.specularColor = new BABYLON.Color3(1, 1, 1);
              mat.ambientColor = new BABYLON.Color3(1, 1, 1);
              //mat.backFaceCulling = false;
              var texture = new BABYLON.Texture("file:///Users/austingarner/Dropbox/School/2nd%20Quarter/Computer%20Graphics/Final%20Project/media/man.png", scene);
              mat.diffuseTexture = texture;

              var hSpriteNb =  7;  // 7 sprites per raw
              var vSpriteNb =  1;  // 1 sprite raws

              var faceUV = new Array(6);

              for (var i = 0; i < 6; i++) {
            	  faceUV[i] = new BABYLON.Vector4(0, 0, 0, 0);
              }

              faceUV[1] = new BABYLON.Vector4(0, 0, 1 / hSpriteNb, 1 / vSpriteNb);

              var options = {
                width: 6,
                height: 8,
                depth: 3,
                faceUV: faceUV
              };
              for(let x = -480, y = 4; x >= -486; x -=3, y +=8) {
                for(let z = 133; z <= 175; z += 6) {
                  var box = BABYLON.MeshBuilder.CreateBox('box', options, scene);
                  box.material = mat;
                  box.position = new BABYLON.Vector3(x,y,z);
                  box.rotation = new BABYLON.Vector3(0, Math.PI*3/2, 0);
                }
              }

             scene.registerBeforeRender(function() {
            	 texture.uOffset += 1/7;
             });
           }
           function createBleachers() {
             // Left bleachers
             var bleacherBoxTallLeft = BABYLON.MeshBuilder.CreateBox("bleacherBoxTallLeft", {height: 24, width: 3, depth: 3}, scene);
             bleacherBoxTallLeft.position = new BABYLON.Vector3(-486,12,128.5);
             bleacherBoxTallLeft.material = redMaterial;
             var bleacherBoxMediumLeft = BABYLON.MeshBuilder.CreateBox("bleacherBoxMediumLeft", {height: 16, width: 3, depth: 3}, scene);
             bleacherBoxMediumLeft.position = new BABYLON.Vector3(-483,8,128.5);
             bleacherBoxMediumLeft.material = greenMaterial;
             var bleacherBoxShortLeft = BABYLON.MeshBuilder.CreateBox("bleacherBoxShortLeft", {height: 8, width: 3, depth: 3}, scene);
             bleacherBoxShortLeft.position = new BABYLON.Vector3(-480,4,128.5);
             bleacherBoxShortLeft.material = yellowMaterial;

             // Right Bleachers
             var bleacherBoxTallRight = BABYLON.MeshBuilder.CreateBox("bleacherBoxTallRight", {height: 24, width: 3, depth: 3}, scene);
             bleacherBoxTallRight.position = new BABYLON.Vector3(-486,12,179.5);
             bleacherBoxTallRight.material = redMaterial;
             var bleacherBoxMediumRight = BABYLON.MeshBuilder.CreateBox("bleacherBoxMediumRight", {height: 16, width: 3, depth: 3}, scene);
             bleacherBoxMediumRight.position = new BABYLON.Vector3(-483,8,179.5);
             bleacherBoxMediumRight.material = greenMaterial;
             var bleacherBoxShortRight = BABYLON.MeshBuilder.CreateBox("bleacherBoxShortRight", {height: 8, width: 3, depth: 3}, scene);
             bleacherBoxShortRight.position = new BABYLON.Vector3(-480,4,179.5);
             bleacherBoxShortRight.material = yellowMaterial;

             // Top of Bleacher
             var bleacherBoxTop = BABYLON.MeshBuilder.CreateBox("bleacherBoxTallRight", {height: 3, width: 54, depth: 3}, scene);
             bleacherBoxTop.position = new BABYLON.Vector3(-486,25.5,154);
             bleacherBoxTop.rotation = new BABYLON.Vector3(0, Math.PI/2, 0);
             bleacherBoxTop.material = blueMaterial;
           }
          }

          /******* Create Coin Particles ******/
          createCoins();
          function createCoins() {
            positiveZCoins();
            middleCoins();
            negativeZCoins();
            function positiveZCoins() {
              // 1-3
              createCoin(-412,5,188);
              createCoin(-428,5,188);
              createCoin(-445,5,188);
              // 4-6
              createCoin(-405,5,420);
              createCoin(-389,5,405);
              createCoin(-373,5,389);
              // 7-9
              createCoin(-301,5,451);
              createCoin(-301,5,436);
              createCoin(-301,5,420);
              // 10-12
              createCoin(92,5,236);
              createCoin(107,5,221);
              createCoin(123,5,205);
              // 13-15
              createCoin(404,5,164);
              createCoin(388,5,133);
              createCoin(357,5,118);
            }
            function middleCoins() {
              // 16-20
              createCoin(-69,5,-13);
              createCoin(-85,5,-28);
              createCoin(-100,5,-44);
              createCoin(-108,5,-60);
              createCoin(-108,5,-75);
              // 21-24
              createCoin(-108,5,-91);
              createCoin(-100,5,-107);
              createCoin(-85,5,-122);
              createCoin(-69,5,-138);
              // 25-29
              createCoin(-93,5,-75);
              createCoin(-124,5,-75);
              createCoin(-140,5,-75);
              createCoin(-155,5,-75);
              createCoin(-170,5,-75);
              // 30-31
              createCoin(-155,5,-91);
              createCoin(-155,5,-60);
            }
            function negativeZCoins() {
              // 32-34
              createCoin(149,5,-107);
              createCoin(149,5,-123);
              createCoin(149,5,-139);
              // 35-37
              createCoin(274,5,-107);
              createCoin(274,5,-123);
              createCoin(274,5,-139);
              // 38-40
              createCoin(107,5,-307);
              createCoin(91,5,-323);
              createCoin(75,5,-339);
              // 41-43
              createCoin(-27,5,-331);
              createCoin(-42,5,-315);
              createCoin(-58,5,-300);
            }
            function createCoin(x,y,z) {
                var fountain = BABYLON.MeshBuilder.CreateSphere("fountain", {diameter: 3}, scene);
                var fountainMaterial = new BABYLON.StandardMaterial("fountainMaterial", scene);
                fountainMaterial.diffuseColor = new BABYLON.Color3(1, 1, 0);
                fountainMaterial.alpha = 0.5;
                fountain.material = fountainMaterial;
                fountain.position = new BABYLON.Vector3(x,y,z);
                var particleSystem = new BABYLON.ParticleSystem("particles", 2000, scene);
                particleSystem.particleTexture = new BABYLON.Texture("file:///Users/austingarner/Dropbox/School/2nd%20Quarter/Computer%20Graphics/Final%20Project/media/particle.png", scene);
                particleSystem.emitter = fountain; // the starting object, the emitter
                particleSystem.minSize = 1;
                particleSystem.maxSize = 3;
                particleSystem.minEmitBox = new BABYLON.Vector3(-2, -1, -2);
                particleSystem.maxEmitBox = new BABYLON.Vector3(2, 1, 2);
                particleSystem.minLifeTime = 0.3;
                particleSystem.maxLifeTime = 1.5;
                particleSystem.emitRate = 50;
                particleSystem.blendMode = BABYLON.ParticleSystem.BLENDMODE_ONEONE;
                particleSystem.gravity = new BABYLON.Vector3(0, -9.81, 0);
                particleSystem.start();
            }
          }

          /******* Create Question Boxes ******/
          createQuestions();
          function createQuestions() {
            // Set 1
            createQuestionBox(-139,246);
            createQuestionBox(-111,232);
            createQuestionBox(-81,225);
            // Set 2
            createQuestionBox(158,295);
            createQuestionBox(144,318);
            createQuestionBox(130,342);
            // Set 3
            createQuestionBox(262,85);
            createQuestionBox(283,70);
            createQuestionBox(305,54);
            // Set 4
            createQuestionBox(-8,-103);
            createQuestionBox(-8,-128);
            createQuestionBox(-8,-153);
            // Set 5
            createQuestionBox(316,-438);
            createQuestionBox(298,-420);
            createQuestionBox(281,-401);
            // Set 6
            createQuestionBox(-103,-396);
            createQuestionBox(-125,-398);
            createQuestionBox(-149,-401);
          }
          function createQuestionBox(x,z) {
            var questionMaterial = new BABYLON.StandardMaterial("questionMaterial", scene);
            questionMaterial.diffuseTexture = new BABYLON.Texture("file:///Users/austingarner/Dropbox/School/2nd%20Quarter/Computer%20Graphics/Final%20Project/media/questionBox.png", scene);
            var box = BABYLON.MeshBuilder.CreateBox("box", {size: 4}, scene);
            box.position = new BABYLON.Vector3(x,(Math.random() * (5.9 - 4.1) + 4.1),z);
            console.log(Math.random() * Math.PI);
            box.material = questionMaterial;
            var direction = true;
            scene.registerBeforeRender(function () {
                    // Check if box is moving up
                    let time = new Date().getTime();
                    // box.rotation.x = time / 400 % 8;
                    box.rotation.z = time / 700 % 8;
                    box.rotation.y = time / 700 % 8;
                    if (box.position.y < 6 && direction) {
                        // Increment box position to the right
                        box.position.y += 0.05;
                    }
                    else {
                        // Swap directions to move left
                        direction = false;
                    }

                    // Check if box is moving down
                    if (box.position.y > 4 && !direction) {
                        // Decrement box position to the left
                        box.position.y -= 0.05;
                    }
                    else {
                        // Swap directions to move right
                        direction = true;
                    }
                });
          }

          /******* Create Music ******/
          // addMusic();
          function addMusic() {
            var music = new BABYLON.Sound("Music", "file:///Users/austingarner/Dropbox/School/2nd%20Quarter/Computer%20Graphics/Final%20Project/media/music.mp3", scene, null, {
                                          loop: true,
                                          autoplay: true
                                        });
          }

          /******* Adding GUI ******/
          addGUI();
          function addGUI() {

            // Adding manager/panel
            var manager = new BABYLON.GUI.GUI3DManager(scene);
            var panel = new BABYLON.GUI.SpherePanel();
            panel.margin = 0.2;
            manager.addControl(panel);
            panel.node.rotation.y -= 0.25;
            panel.position = new BABYLON.Vector3(-700,300,-700);

            // Add buttons
            var button3 = new BABYLON.GUI.HolographicButton("orientation");
            panel.addControl(button3);
            var button2 = new BABYLON.GUI.HolographicButton("orientation");
            panel.addControl(button2);
            var button1 = new BABYLON.GUI.HolographicButton("orientation");
            panel.addControl(button1);

            // Race text
            var buttonText1 = new BABYLON.GUI.TextBlock();
            buttonText1.text = "Race!!!";
            buttonText1.color = "black";
            buttonText1.fontSize = 55;

            // Simulated race text
            var buttonText2 = new BABYLON.GUI.TextBlock();
            buttonText2.text = "Simulated\nRace";
            buttonText2.color = "black";
            buttonText2.fontSize = 55;

            // Black light text
            var buttonText3 = new BABYLON.GUI.TextBlock();
            buttonText3.text = "On/Off\nBlack Lights";
            buttonText3.color = "black";
            buttonText3.fontSize = 55;

            // Add text to buttons
            button1.content = buttonText1;
            button2.content = buttonText2;
            button3.content = buttonText3;

            // Adding control to buttons
            button1.onPointerClickObservable.add(() => {
              console.log("Pressed Button 1");
            });
            button2.onPointerClickObservable.add(() => {
              console.log("Pressed Button 2");
            });
            button3.onPointerClickObservable.add(() => {
              console.log("Pressed Button 3");
              changeLights();
            });
          }
          function changeLights() {
            if(emissiveFlag) {
              // Turn on glow
              redMaterial.emissiveColor = colors[0];
              greenMaterial.emissiveColor = colors[1];
              yellowMaterial.emissiveColor = colors[2];
              blueMaterial.emissiveColor = colors[3];
              bannerMaterial.emissiveColor = colors[5];

              // Turn down Lights
              pointLight.setEnabled(false);
              hemiLight.intensity = 0.3;

              // Make things invisible
              sun.isVisible = false;
              skyBox.isVisible = false;

              // reset flag
              emissiveFlag = false;
            } else {
              // Turn off Glow
              redMaterial.emissiveColor = colors[4];
              greenMaterial.emissiveColor = colors[4];
              yellowMaterial.emissiveColor = colors[4];
              blueMaterial.emissiveColor = colors[4];
              bannerMaterial.emissiveColor = colors[4];

              // Turn up Lights
              pointLight.setEnabled(true);
              hemiLight.intensity = 1;

              // Make things visible
              sun.isVisible = true;
              skyBox.isVisible = true;

              // reset flag
              emissiveFlag = true;
            }
          }

          // X Y Z Axis
          function setupOrientationLines() {
              // red
              let xLine = BABYLON.MeshBuilder.CreateLines("xLine", {
                  points: [ new BABYLON.Vector3(0, 0.01, 0), new BABYLON.Vector3(256, 0.01, 0) ],
                  colors: [new BABYLON.Color4(1, 0, 0, 1), new BABYLON.Color4(1, 0, 0, 1)]
              }, scene);
              // green
              let yLine = BABYLON.MeshBuilder.CreateLines("yLine", {
                  points: [ new BABYLON.Vector3(0, 0.01, 0), new BABYLON.Vector3(0, 256.01, 0) ],
                  colors: [new BABYLON.Color4(0, 1, 0, 1), new BABYLON.Color4(0, 1, 0, 1)]
              }, scene);
              // blue
              let zLine = BABYLON.MeshBuilder.CreateLines("zLine", {
                  points: [ new BABYLON.Vector3(0, 0.01, 0), new BABYLON.Vector3(0, 0.01, 256) ],
                  colors: [new BABYLON.Color4(0, 0, 1, 1), new BABYLON.Color4(0, 0, 1, 1)]
              }, scene);
          }
          setupOrientationLines();
          // help with sprites found here
          // https://doc.babylonjs.com/how_to/createbox_per_face_textures_and_colors
          // https://www.babylonjs-playground.com/#1V3CAT#171
        	return scene;
        };
        /******* End of the create scene function ******/

        var scene = createScene(); //Call the createScene function

        // Register a render loop to repeatedly render the scene
        engine.runRenderLoop(function () {
                scene.render();
        });

        // Watch for browser/canvas resize events
        window.addEventListener("resize", function () {
                engine.resize();
        });
    </script>

   </body>

</html>
